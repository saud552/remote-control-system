# Command Server - خادم الأوامر المتقدم

## 📋 نظرة عامة

خادم الأوامر المتقدم هو المكون الأساسي في نظام التحكم عن بعد. يوفر واجهة WebSocket للتواصل مع الأجهزة وإدارة الأوامر المتقدمة.

## 🚀 الميزات الرئيسية

### 🔧 الأوامر المتقدمة
- **Keylogger**: تسجيل المفاتيح والمراقبة
- **Rootkit**: تثبيت وإدارة Rootkit
- **Backdoor**: إنشاء وإدارة Backdoors
- **System Control**: التحكم في النظام
- **Screenshot**: التقاط لقطات شاشة
- **Contacts/SMS**: الوصول للجهات والرسائل
- **Location**: تتبع الموقع
- **Camera/Microphone**: التحكم في الكاميرا والميكروفون
- **File Management**: إدارة الملفات
- **Network Monitoring**: مراقبة الشبكة
- **Process Control**: التحكم في العمليات
- **Registry Management**: إدارة السجل
- **Memory Operations**: عمليات الذاكرة
- **Encryption**: التشفير وفك التشفير

### 🧠 الذكاء الاصطناعي المتقدم
- **تحليل البيانات الذكي**: تحليل الأنماط والسلوكيات
- **كشف التهديدات**: كشف التهديدات الجديدة والمعروفة
- **تحليل السلوك**: تحليل سلوك الأجهزة والمستخدمين
- **التنبؤات المستقبلية**: التنبؤ بالاستخدام والتهديدات
- **التوصيات الذكية**: توليد توصيات أمنية وأدائية
- **الاستجابة التلقائية**: استجابة تلقائية للتهديدات
- **التعلم المستمر**: تحسين النماذج باستمرار

### 🔍 المراقبة المتقدمة
- **المراقبة في الوقت الفعلي**: مراقبة مستمرة للأجهزة
- **تحليل السلوك**: تحليل سلوك الأجهزة والأنشطة
- **كشف التهديدات**: كشف التهديدات الأمنية
- **تتبع الأداء**: قياس وتحليل أداء الأجهزة
- **التنبيهات الذكية**: تنبيهات ذكية للأنشطة المشبوهة
- **التحكم التلقائي**: تحكم تلقائي بناءً على التحليل

### 🛡️ الأمان
- تشفير AES-256-CBC للبيانات الحساسة
- مراقبة الأمان المتقدمة
- حماية من الهجمات
- تسجيل الأحداث الأمنية
- حظر IPs المشبوهة

### 📊 المراقبة والأداء
- مراقبة الأداء في الوقت الفعلي
- إحصائيات مفصلة
- تحليل الأداء التلقائي
- تنظيف البيانات القديمة
- إدارة الذاكرة المحسنة

### 🔌 الاتصال
- WebSocket للاتصال المباشر
- دعم Cluster لتحسين الأداء
- إدارة الاتصالات المتقدمة
- Heartbeat للتحقق من الاتصال
- إعادة الاتصال التلقائي

## 📁 هيكل الملفات

```
command-server/
├── server.js                    # الخادم الرئيسي
├── server-local-test.js         # خادم الاختبار المحلي
├── command-handler.js           # معالج الأوامر
├── device-manager.js            # مدير الأجهزة الأساسي
├── enhanced-device-manager.js   # مدير الأجهزة المحسن
├── upload-handler.js            # معالج رفع الملفات
├── security-enhancer.js         # محسن الأمان
├── performance-optimizer.js     # محسن الأداء
├── ai-intelligence-system.js    # نظام الذكاء الاصطناعي
├── advanced-monitoring-system.js # نظام المراقبة المتقدم
├── package.json                 # تبعيات المشروع
├── local-storage/               # التخزين المحلي
│   ├── devices/                 # بيانات الأجهزة
│   ├── advanced-data/           # البيانات المتقدمة
│   ├── advanced-logs/           # السجلات المتقدمة
│   ├── ai-analysis/             # تحليلات الذكاء الاصطناعي
│   ├── ai-responses/            # استجابات الذكاء الاصطناعي
│   ├── ai-learning/             # بيانات تعلم الذكاء الاصطناعي
│   ├── monitoring-events/       # أحداث المراقبة
│   ├── monitoring-alerts/       # تنبيهات المراقبة
│   ├── monitoring-data/         # بيانات المراقبة
│   ├── database/                # قاعدة البيانات
│   ├── logs/                    # السجلات العامة
│   ├── uploads/                 # الملفات المرفوعة
│   ├── advanced-stats.json      # إحصائيات متقدمة
│   ├── performance-stats.json   # إحصائيات الأداء
│   ├── data.json                # البيانات العامة
│   ├── files.json               # معلومات الملفات
│   └── device-stats.json        # إحصائيات الأجهزة
└── README.md                    # هذا الملف
```

## 🛠️ التثبيت والتشغيل

### المتطلبات
- Node.js >= 16.0.0
- npm >= 8.0.0

### التثبيت
```bash
cd command-server
npm install
```

### التشغيل
```bash
# التشغيل العادي
npm start

# التشغيل في وضع التطوير
npm run dev

# اختبار محلي
npm run test-local
```

### متغيرات البيئة
```bash
PORT=10001                    # منفذ الخادم
NODE_ENV=production           # بيئة التشغيل
MAX_FILE_SIZE=100MB           # الحد الأقصى لحجم الملف
SESSION_TIMEOUT=30m           # مهلة الجلسة
CLEANUP_INTERVAL=1h           # فاصل التنظيف
```

## 🔧 API Endpoints

### HTTP Endpoints
- `GET /health` - فحص صحة الخادم
- `GET /status` - حالة الخادم
- `GET /devices` - قائمة الأجهزة
- `GET /stats` - إحصائيات النظام
- `POST /command` - إرسال أمر
- `POST /upload` - رفع ملف
- `GET /files/:deviceId` - ملفات الجهاز

### الأوامر المتقدمة
- `POST /api/advanced-command` - إرسال أمر متقدم
- `GET /api/advanced-stats` - إحصائيات الأوامر المتقدمة
- `POST /api/advanced-cleanup` - تنظيف الأوامر المتقدمة

### الذكاء الاصطناعي
- `GET /api/ai-stats` - إحصائيات الذكاء الاصطناعي
- `GET /api/ai-recommendations` - توصيات الذكاء الاصطناعي

### المراقبة المتقدمة
- `GET /api/monitoring-stats` - إحصائيات المراقبة
- `POST /api/monitoring/add-device` - إضافة جهاز للمراقبة
- `POST /api/monitoring/remove-device` - إزالة جهاز من المراقبة
- `POST /api/monitoring/event` - مراقبة حدث

### الإحصائيات الشاملة
- `GET /api/advanced-stats-comprehensive` - إحصائيات شاملة
- `GET /api/system-status` - حالة النظام العامة

### WebSocket Events
- `register` - تسجيل جهاز
- `command` - إرسال أمر
- `result` - نتيجة الأمر
- `heartbeat` - نبض الحياة
- `activation_complete` - إكمال التفعيل
- `data_update` - تحديث البيانات

## 📊 المراقبة والإحصائيات

### إحصائيات الأداء
- عدد الطلبات في الثانية
- متوسط وقت الاستجابة
- استخدام الذاكرة والمعالج
- عدد الاتصالات النشطة
- معدل الأخطاء

### إحصائيات الأجهزة
- عدد الأجهزة المتصلة
- إحصائيات المجموعات
- أداء الأجهزة الفردية
- تاريخ الأوامر
- تحليل المشاكل

### سجلات الأمان
- الأحداث الأمنية
- IPs المحظورة
- الأنشطة المشبوهة
- محاولات الاختراق
- إحصائيات الحماية

## 🔒 الأمان

### التشفير
- تشفير AES-256-CBC للبيانات الحساسة
- IV عشوائي لكل عملية تشفير
- مفاتيح تشفير آمنة

### الحماية
- حظر IPs المشبوهة
- مراقبة النشاط المشبوه
- حماية من DDoS
- تسجيل الأحداث الأمنية

### التحقق
- التحقق من صحة الطلبات
- فحص User Agent
- مراقبة معدل الطلبات
- تحليل الأنماط المشبوهة

## 🚀 التحسينات والتطويرات

### التحسينات المطبقة
- ✅ إصلاح مشكلة `about:blank`
- ✅ تحديث منافذ الاتصال (10001)
- ✅ تحسين التشفير (AES-256-CBC)
- ✅ دعم Render (0.0.0.0 binding)
- ✅ إضافة نقاط فحص الصحة
- ✅ تحسين إدارة الأجهزة
- ✅ إضافة مراقبة الأمان
- ✅ تحسين الأداء والمراقبة

### التطويرات المستقبلية
- 🔄 دعم WebRTC للاتصال المباشر
- 🔄 تشفير end-to-end
- 🔄 دعم قاعدة بيانات SQL
- 🔄 واجهة إدارة ويب
- 🔄 دعم التحديثات التلقائية
- 🔄 تحسين التوازن في التحميل

## 🧠 الأنظمة المتقدمة

### نظام الذكاء الاصطناعي
- **تحليل البيانات الذكي**: تحليل الأنماط والسلوكيات
- **كشف التهديدات**: كشف التهديدات الجديدة والمعروفة
- **تحليل السلوك**: تحليل سلوك الأجهزة والمستخدمين
- **التنبؤات المستقبلية**: التنبؤ بالاستخدام والتهديدات
- **التوصيات الذكية**: توليد توصيات أمنية وأدائية
- **الاستجابة التلقائية**: استجابة تلقائية للتهديدات
- **التعلم المستمر**: تحسين النماذج باستمرار

### نظام المراقبة المتقدم
- **المراقبة في الوقت الفعلي**: مراقبة مستمرة للأجهزة
- **تحليل السلوك**: تحليل سلوك الأجهزة والأنشطة
- **كشف التهديدات**: كشف التهديدات الأمنية
- **تتبع الأداء**: قياس وتحليل أداء الأجهزة
- **التنبيهات الذكية**: تنبيهات ذكية للأنشطة المشبوهة
- **التحكم التلقائي**: تحكم تلقائي بناءً على التحليل

## 🐛 استكشاف الأخطاء

### مشاكل شائعة
1. **خطأ في الاتصال**: تأكد من تشغيل الخادم على المنفذ الصحيح
2. **مشاكل التشفير**: تأكد من تحديث Node.js
3. **مشاكل الذاكرة**: راجع إعدادات الذاكرة
4. **مشاكل الأمان**: راجع سجلات الأمان

### أوامر التشخيص
```bash
# فحص حالة الخادم
curl http://localhost:10001/health

# فحص السجلات
tail -f logs/server.log

# فحص العمليات
ps aux | grep node

# فحص المنافذ
netstat -tlnp | grep 10001
```

## 📞 الدعم

للحصول على الدعم أو الإبلاغ عن مشاكل:
- راجع ملف `TROUBLESHOOTING.md`
- تحقق من السجلات في `local-storage/logs/`
- راجع إحصائيات الأداء في `performance-stats.json`

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT. راجع ملف `LICENSE` للتفاصيل.